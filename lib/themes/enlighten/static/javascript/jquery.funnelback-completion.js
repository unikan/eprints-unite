(function($){$.fn.fbcompletion=function(settings){var config={collection:"funnelback_documentation",show:10,sort:0,delay:0,length:3,program:"padre-qs.cgi",format:"simple",enabled:"disabled",tmplId:"fb-completion-tmpl",profile:"_default",zindex:1e3};if(settings)$.extend(config,settings);if(config.enabled!="enabled"){return}this.each(function(){var targetElement=this;var compiledTmpl;if(jQuery().template){if(jQuery("#"+config.tmplId).length>0){compiledTmpl=jQuery("#"+config.tmplId).template()}else{compiledTmpl=jQuery("<script>[Error: Template <code>"+config.tmplId+"</code> not found]</script>").template()}}$(targetElement).autocomplete({appendTo:$("#fb-queryform").length>0?"#fb-queryform":"body",source:function(e,t){jQuery.ajax({type:"GET",url:config.program+"?collection="+config.collection+"&partial_query="+e.term.replace(/ /g,"+")+"&show="+config.show+"&sort="+config.sort+"&alpha="+config.alpha+"&fmt="+(config.format=="simple"?"json":"json++")+(config.profile!==""?"&profile="+config.profile:""),dataType:"jsonp",error:function(e,t,n){if(window.console){console.log("Autocomplete error: "+t+", "+n)}},success:function(n){var r=new Array;var i=new Array;var s=new Array;for(var o=0;o<n.length;o++){var u;var a=n[o];if(a==null){continue}if(typeof a=="string"){r.push({label:a,matchOn:e.term})}else if(typeof a=="object"){if(a.cat){if(!i[a.cat]){i[a.cat]=new Array;s.push(a.cat)}i[a.cat].push({label:a.disp?a.disp:a.key,value:a.action_t=="Q"?a.action:a.key,extra:a,matchOn:e.term})}else{r.push({label:a.disp?a.disp:a.key,value:a.action_t=="Q"?a.action:a.key,extra:a,matchOn:e.term})}}}for(var o=0;o<s.length;o++){var f=s[o];r.push({label:f,category:true});for(var l=0;l<i[f].length;l++){r.push(i[f][l])}}t(r)}})},open:function(){jQuery(this).autocomplete("widget").css("z-index",config.zindex);return false},delay:config.delay,minLength:config.length,select:function(evt,ui){if(ui.item.extra){switch(ui.item.extra.action_t){case"C":eval(ui.item.extra.action);break;case"U":document.location=ui.item.extra.action;break;case undefined:case"":jQuery(this).attr("value",ui.item.value);jQuery(this).context.form.submit();break;case"Q":default:jQuery(this).attr("value",ui.item.extra.action);jQuery(this).context.form.submit()}}else{jQuery(this).attr("value",ui.item.value);jQuery(this).context.form.submit()}return false}}).data("autocomplete")._renderItem=function(ul,item){var label;if(item.category){return jQuery("<li><h2>"+item.label+"</h2></li>").appendTo(ul)}else if(item.extra){switch(item.extra.disp_t){case"J":if(compiledTmpl){label=jQuery.tmpl(compiledTmpl,item.extra.disp).appendTo("<p></p>").parent().html()}else{label="[Error: jQuery template plugin is unavailable]"}break;case"C":label=eval(item.extra.disp);break;case"T":label=item.label.replace(new RegExp("("+item.matchOn+")","i"),"<strong>$1</strong>");break;case"H":default:label=item.label}}else{label=item.label.replace(new RegExp("("+item.matchOn+")","i"),"<strong>$1</strong>")}return jQuery("<li></li>").data("item.autocomplete",item).append("<a>"+label+"</a>").appendTo(ul)}});return this}})(jQuery)// Query completion setup.jQuery(function() {    jQuery("#ssKeywords").fbcompletion({        'enabled'    : 'enabled',        'collection' : 'staff-and-website-meta',        'program'    : 'http://search.gla.ac.uk/s/suggest.json',        'format'     : 'simple',        'alpha'      : '.5',        'show'       : '10',        'sort'       : '0',        'length'     : '3',        'delay'      : '0',        'profile'    : '_default'    });});
